---
definitions:
  - &iptablesban iptables -I reaction 1 -s <ip> -j block
  - &iptablesunban iptables -D reaction 1 -s <ip> -j block

patterns:
  ip: '(([0-9]{1,3}\.){3}[0-9]{1,3})|([0-9a-fA-F:]{2,90})'

streams:
  tailDown:
    cmd: [ "sh", "-c", "echo 'found 1.1.1.1' && sleep 2s && echo 'found 1.1.1.2' && sleep 2s && echo 'found 1.1.1.1' && sleep 1s" ]
    filters:
      findIP:
        regex:
          - found <ip>
        retry: 2
        retry-period: 5s
        actions:
          damn:
            cmd: [ "echo", "<ip>" ]
          sleepdamn:
            cmd: [ "echo", "sleep", "<ip>" ]
            after: 1s
